sequenceDiagram
    participant RSU as RSU (Roadside Unit)
    participant Att as Attacker
    participant Veh as Vehicle (Receiver)
    participant TS as TimeServer/Validator

    RSU->>Veh: MSG(payload="GREEN_LIGHT", ts, mac=HMAC)
    Note over Att,RSU: Attacker sniffs the broadcast

    Att->>Veh: (replayed) MSG(payload, old_ts, mac)
    Veh->>Veh: verify MAC (HMAC)
    alt MAC invalid
        Veh--x Att: reject (MAC fail)
        Note right of Veh: log and alert
    else MAC valid
        Veh->>TS: request freshness_check(ts)
        TS-->>Veh: ts_status = fresh | stale | revoked
        alt ts_status == fresh
            Veh->>Veh: accept and act (GREEN_LIGHT)
            Veh->>RSU: ack (optional) with seq_num
        else ts_status == stale
            Veh--x Att: reject (stale/replay)
            Veh->>RSU: optional alert: "stale timestamp detected"
        else ts_status == revoked
            Veh--x Att: reject (revoked key)
            Veh->>SecuritySystem: alert (possible compromise)
        end
    end
