sequenceDiagram
    participant RSU as RSU (Roadside Unit)
    participant Attacker
    participant Vehicle as Vehicle (Receiver)

    RSU->>Vehicle: MSG(payload="GREEN_LIGHT", ts, mac=HMAC)

    Note over Attacker,RSU: Attacker sniffs the broadcast

    Attacker->>Vehicle: (replayed) MSG(payload, old_ts, mac)

    Vehicle->>Vehicle: verify MAC

    alt MAC invalid
        Vehicle--x Attacker: reject (MAC fail)
    else MAC valid
        Vehicle->>Vehicle: check freshness (|now - ts| <= window)
        alt fresh
            Vehicle->>Vehicle: accept and act
        else
            Vehicle--x Attacker: reject (stale/replay)
        end
    end
